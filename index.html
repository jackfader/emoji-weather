<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emoji Weather Forecast</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
<style>
body {background-color: #81d4fa;font-family: Roboto, sans-serif;}
.container {margin-top: 50px;}
.emoji {font-size: 5rem;}
.forecast {margin-top: 30px;}
.zip-container {margin-bottom: 15px;}
.refresh-btn {margin-top: 15px;}
</style>
</head>
<body>
<div class="container">
  <div class="row"><div class="col s12 center-align"><h3>Emoji Weather Forecast</h3><div id="currentWeather" class="emoji"></div><p id="currentLocation"></p></div></div>
  <div class="row forecast" id="forecast"></div>
  <div class="row"><div class="col s12 center-align"><div class="zip-container"><input type="text" id="zipCode" placeholder="Enter zip code"><button class="btn waves-effect waves-light" onclick="getWeatherByZip()">Get Weather by Zip</button></div><button class="btn waves-effect waves-light refresh-btn" onclick="getLocation()">Refresh</button><p id="lastUpdated">Last updated: </p>  <p class="api-credit">Weather data provided by <a href="https://openweathermap.org/" target="_blank">OpenWeather API</a></p>
</div></div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
const apiKey = '1e0c872c5b5e02218e4f65745eb58eb2';
const emojiMap = {'2': '⛈️', '3': '🌧️', '5': '☔', '6': '❄️', '7': '🌫️', '800': '☀️', '8': '⛅'}

function getLocation() {
  if (navigator.geolocation) {
    $('#forecast').empty();
    navigator.geolocation.getCurrentPosition(fetchData);
  }
}

function getWeatherByZip() {
  const zipCode = $('#zipCode').val();
  if (zipCode) {
    $('#forecast').empty();
    fetchData(`https://api.openweathermap.org/data/2.5/weather?zip=${zipCode}&appid=${apiKey}`, `https://api.openweathermap.org/data/2.5/forecast?zip=${zipCode}&appid=${apiKey}`);
  }
}

function fetchData(url1, url2) {
  fetch(url1)
    .then(response => response.json())
    .then(displayCurrentWeather);

  fetch(url2)
    .then(response => response.json())
    .then(displayForecast);
}

function displayCurrentWeather(data) {
  $('#currentWeather').text(emojiMap[data.weather[0].id.toString()[0]]);
$('#currentLocation').text(`Now - ${data.name}`);
  $('#lastUpdated').text(`Last updated: ${new Date().toLocaleTimeString()}`);
}

function displayForecast(data) {
  const forecasts = data.list.filter(forecast => new Date(forecast.dt * 1000).getHours() === 8);

  forecasts.forEach((forecast, i) => {
      const date = new Date(forecast.dt * 1000);
      const dayName = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][date.getDay()];

      $('#forecast').append(`<div class="col s2 ${i === 0 ? 'offset-s1' : ''} center-align"><div class="emoji">${emojiMap[forecast.weather[0].id.toString()[0]]}</div><p>${dayName}</p></div>`);
    });
  }

getLocation();
</script>
</body>
</html>
